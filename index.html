<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teleprompter - Chá»n cháº¿ Ä‘á»™</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="index-container">
        <h1>ğŸ“º Teleprompter version 2.2</h1>
        
        <div class="input-group">
            <label for="sheetUrl">URL Google Sheet (cÃ´ng khai):</label>
            <input 
                type="text" 
                id="sheetUrl" 
                placeholder="https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/edit"
                value=""
            >
            <div class="error-message" id="errorMessage"></div>
        </div>
        
        <div class="input-group">
            <label>Cháº¿ Ä‘á»™ sá»­ dá»¥ng:</label>
            <div class="mode-selection">
                <label class="radio-option">
                    <input type="radio" name="mode" id="modeStandalone" value="standalone" checked>
                    <span class="radio-label">ğŸ”„ Cháº¡y Ä‘á»™c láº­p</span>
                    <small>Teleprompter hoáº¡t Ä‘á»™ng Ä‘á»™c láº­p, khÃ´ng cáº§n Remote</small>
                </label>
                <label class="radio-option">
                    <input type="radio" name="mode" id="modeRemote" value="remote">
                    <span class="radio-label">ğŸ® Cháº¡y qua Remote</span>
                    <small>Äiá»u khiá»ƒn tá»« xa báº±ng thiáº¿t bá»‹ khÃ¡c</small>
                </label>
            </div>
        </div>
        
        <div class="input-group" id="sessionGroup" style="display: none;">
            <label for="sessionId">Session ID:</label>
            <input 
                type="text" 
                id="sessionId" 
                placeholder="Äá»ƒ trá»‘ng Ä‘á»ƒ táº¡o session má»›i"
                value=""
            >
            <small>Chia sáº» Session ID nÃ y vá»›i thiáº¿t bá»‹ Teleprompter Ä‘á»ƒ káº¿t ná»‘i</small>
        </div>
        
        <div class="button-group">
            <a href="#" class="btn btn-primary" id="btnTeleprompter">ğŸ“± Má»Ÿ Teleprompter</a>
            <a href="#" class="btn btn-secondary" id="btnRemote" style="display: none;">ğŸ® Má»Ÿ Remote</a>
        </div>
        
        <div class="loading" id="loading" style="display: none;">
            Äang táº£i dá»¯ liá»‡u tá»« Google Sheet...
        </div>
    </div>

    <script src="js/sheets.js"></script>
    <script>
        const sheetUrlInput = document.getElementById('sheetUrl');
        const sessionIdInput = document.getElementById('sessionId');
        const btnTeleprompter = document.getElementById('btnTeleprompter');
        const btnRemote = document.getElementById('btnRemote');
        const errorMessage = document.getElementById('errorMessage');
        const loading = document.getElementById('loading');

        const modeStandalone = document.getElementById('modeStandalone');
        const modeRemote = document.getElementById('modeRemote');
        const sessionGroup = document.getElementById('sessionGroup');
        
        // Kiá»ƒm tra náº¿u cÃ³ session ID trong localStorage
        const savedSession = localStorage.getItem('teleprompter_session');
        if (savedSession && !sessionIdInput.value) {
            sessionIdInput.value = savedSession;
            // Náº¿u cÃ³ session Ä‘Ã£ lÆ°u, tá»± Ä‘á»™ng chá»n cháº¿ Ä‘á»™ Remote
            modeRemote.checked = true;
            sessionGroup.style.display = 'block';
            btnRemote.style.display = 'block';
        }

        // Xá»­ lÃ½ thay Ä‘á»•i cháº¿ Ä‘á»™
        modeStandalone.addEventListener('change', () => {
            if (modeStandalone.checked) {
                sessionGroup.style.display = 'none';
                btnRemote.style.display = 'none';
            }
        });

        modeRemote.addEventListener('change', () => {
            if (modeRemote.checked) {
                sessionGroup.style.display = 'block';
                btnRemote.style.display = 'block';
            }
        });

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
        }

        function hideError() {
            errorMessage.classList.remove('show');
        }

        function validateAndNavigate(mode) {
            const sheetUrl = sheetUrlInput.value.trim();
            const sessionId = sessionIdInput.value.trim();
            const isRemoteMode = modeRemote.checked;

            hideError();

            if (!sheetUrl) {
                showError('Vui lÃ²ng nháº­p URL Google Sheet');
                return;
            }

            if (!validateSheetUrl(sheetUrl)) {
                showError('URL khÃ´ng há»£p lá»‡. Vui lÃ²ng nháº­p URL Google Sheets Ä‘Ãºng Ä‘á»‹nh dáº¡ng.');
                return;
            }

            // LÆ°u sheet URL vÃ o localStorage
            localStorage.setItem('teleprompter_sheet_url', sheetUrl);

            // Táº¡o URL vá»›i tham sá»‘
            let url = mode === 'teleprompter' ? 'teleprompter.html' : 'remote.html';
            url += '?sheet=' + encodeURIComponent(sheetUrl);
            
            // Náº¿u cháº¿ Ä‘á»™ Remote hoáº·c cÃ³ session ID, thÃªm session vÃ o URL
            if (isRemoteMode && sessionId) {
                url += '&session=' + encodeURIComponent(sessionId);
                localStorage.setItem('teleprompter_session', sessionId);
            } else if (isRemoteMode && !sessionId) {
                // Táº¡o session má»›i náº¿u chÆ°a cÃ³
                const newSessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                url += '&session=' + encodeURIComponent(newSessionId);
                localStorage.setItem('teleprompter_session', newSessionId);
            }

            window.location.href = url;
        }

        btnTeleprompter.addEventListener('click', (e) => {
            e.preventDefault();
            validateAndNavigate('teleprompter');
        });

        btnRemote.addEventListener('click', (e) => {
            e.preventDefault();
            validateAndNavigate('remote');
        });

        // Enter key Ä‘á»ƒ submit
        sheetUrlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                validateAndNavigate('teleprompter');
            }
        });
    </script>
</body>
</html>

